# Issue #6: Render へデプロイ

## 概要
Docker イメージ最適化、Render Starter & Postgres 作成、環境変数設定、Auto-Deploy 設定を行い、本番環境を構築する。

## ゴール
main ブランチへ push すると Render で本番環境が再デプロイされ、外部 URL でアプリが動作する状態を実現する。

## スコープ

### 含まれる内容
- [ ] 本番用 Docker イメージの最適化
- [ ] Render Web Service の作成・設定
- [ ] Render PostgreSQL の作成・設定
- [ ] 環境変数の設定
- [ ] Auto-Deploy の設定
- [ ] HTTPS・セキュリティ設定
- [ ] 本番データベースのセットアップ

### 含まれない内容
- 独自ドメインの設定
- CDN の設定
- 高度な監視・アラート設定

## 受入条件

- [ ] Render で Web サービスが正常に動作する
- [ ] PostgreSQL が正常に接続される
- [ ] main ブランチへの push で自動デプロイされる
- [ ] 外部 URL でアプリにアクセスできる
- [ ] HTTPS が有効になっている
- [ ] 本番環境で認証が動作する
- [ ] 本番環境で打刻機能が動作する
- [ ] 本番環境で Excel 出力が動作する

## 技術仕様

### Render サービス構成
- Web Service: Docker (Starter プラン - $7/月)
- PostgreSQL: Basic プラン ($7.5/月)
- 合計: 約 $14.5/月

### Docker 最適化
- Multi-stage build
- Alpine Linux ベース
- フロントエンドビルド物の組み込み
- 不要ファイルの除外

### セキュリティ設定
- HTTPS 強制
- Secure Headers
- CSRF 保護
- Session Cookie セキュリティ

## タスク

### Docker 本番イメージ最適化
- [ ] Dockerfile の本番用最適化
- [ ] Multi-stage build の調整
- [ ] イメージサイズの最小化
- [ ] セキュリティスキャン対応

### Render サービス作成
- [ ] Render アカウント設定
- [ ] Web Service の作成・設定
- [ ] PostgreSQL サービスの作成
- [ ] サービス間接続の設定

### 環境変数設定
- [ ] DATABASE_URL の設定
- [ ] SECRET_KEY_BASE の設定
- [ ] RAILS_ENV=production
- [ ] セキュリティ関連環境変数

### データベース設定
- [ ] 本番 DB の初期セットアップ
- [ ] マイグレーション実行
- [ ] 初期データ投入
- [ ] バックアップ設定確認

### Auto-Deploy 設定
- [ ] GitHub 連携設定
- [ ] Auto-Deploy の有効化
- [ ] ブランチ設定（main）
- [ ] デプロイフック設定

### 本番設定調整
- [ ] Rails 本番環境設定
- [ ] Asset 配信設定
- [ ] ログ設定
- [ ] エラー監視設定

### セキュリティ強化
- [ ] HTTPS 強制設定
- [ ] Secure Headers の設定
- [ ] CORS 設定の調整
- [ ] Session 設定の最適化

### 動作確認
- [ ] デプロイ成功確認
- [ ] 基本機能の動作確認
- [ ] 認証機能の動作確認
- [ ] 打刻機能の動作確認
- [ ] 管理機能の動作確認
- [ ] Excel 出力の動作確認

### 運用準備
- [ ] 監視・ログ確認方法の整備
- [ ] バックアップ手順の確認
- [ ] デプロイ手順書の作成
- [ ] 障害対応手順の整備

### パフォーマンス確認
- [ ] レスポンス時間測定
- [ ] メモリ使用量確認
- [ ] データベース性能確認

### ドキュメント更新
- [ ] README.md の本番環境情報追加
- [ ] デプロイ手順の記載
- [ ] 環境変数一覧の整備

### テスト
- [ ] 本番環境での E2E テスト
- [ ] セキュリティテスト
- [ ] 負荷テスト（軽微）

## 参考資料
- `/doc/詳細設計.md` の「コンテナ & デプロイ構成」
- `/doc/詳細設計.md` の「Render サービス」
- `/doc/要件定義.md` の「コスト試算」
- Render 公式ドキュメント
